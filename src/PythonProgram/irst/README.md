# Prompt（用于生成/编写 Python + PyQt5 的 “IRST 前端接口特征仿真器/模拟器” 源码）

> 目标：用 Python（3.8.10+）和 PyQt5 实现一个可运行的 IRST（红外搜索与跟踪）前端接口特征仿真软件（桌面应用），用于飞机 IRST 子系统接口特征仿真、无源探测/态势感知、目标检出与跟踪、激光测距、目标定位、威胁告警、隐身目标检测、电子战抗欺骗验证与精确制导武器引导仿真。代码应模块化、类型注解齐全、含示例场景与单元测试，便于集成至综合处理计算机（通过 FC 总线、AFDX、以太网等）。

---

## 一、总体技术要求（必须）

* 语言/依赖：Python 3.8.10+；UI 使用 PyQt5；可选库：numpy、scipy、opencv-python、pillow、asyncio、pyyaml、pydantic、imagecodecs（如需视频压缩/解码）；网络/总线模拟选择：asyncio/aioudp、python-socket、可用第三方库模拟 AFDX/ARINC（若无则提供协议层封装）。
* 代码风格：PEP8、类型注解、模块化、可测试（pytest），README、requirements.txt、示例场景与运行说明。
* 架构：分层设计（仿真内核、传感器模型、跟踪器/定位/测距模块、EW 模块、接口层、UI 层、日志/监控）。配置通过 YAML/JSON 场景文件。
* 可扩展性：关键算法（检出器、跟踪器、融合、抗欺骗逻辑）采用策略接口实现，便于替换为更复杂算法（如 MHT、深度学习检测器）。
* 并发/性能：视频与网络 I/O 使用 asyncio 或多进程，保证图像最高帧率 ≥100Hz（配置可调）；关键耗时（图像处理、压缩）可使用子进程/本地 C-bindings 回退。

---

## 二、功能需求（详细）

### 2.1 核心仿真功能

* 目标生成：支持空中/海/地/巡航导弹等多类型目标，定义 RCS/IR 签名、热度谱、速度、航迹、高度、隐身等级等；支持静态与动态群组/编队。
* IRST 传感器前端模型：实现光学几何模型（视场、分辨率、传感器朝向、视锥遮挡），噪声模型（测角量化、角误差、探测概率 Pd、虚警率 Pfa）、日夜/气象影响（雾/云/烟/散射）。
* 目标检出（detection）：基于温度对比/模板/简单 DNN 示例实现检出逻辑，输出检测框/角位置与置信度；支持隐身目标的低 SNR 情况并能配置检测阈值/背景建模。
* 跟踪（tracking）：实现卡尔曼/扩展卡尔曼滤波 + 数据关联（最近邻/门控）或可替换策略，支持多目标跟踪、丢失/再识别逻辑并输出 track ID、状态、协方差与置信度。
* 激光测距（LIDAR 模拟）：基于传感器-目标几何距离与测距噪声模型输出米级测距（可配置精度），支持脉冲延迟/测距失败（低反射率/大角度）。
* 目标定位与融合：将角测量 + 激光测距（若可用）融合定位（极坐标->笛卡尔转换 + 估计协方差），并支持与其他来源（AESA、分布式孔径、FC/AFDX 数据）进行多源数据融合。

### 2.2 态势感知与威胁告警

* 多级威胁等级：结合角位置、距离、速度、隐身等级、匹配情报库输出威胁告警（高/中/低）并生成告警消息（时间、置信度、建议动作）。
* 隐身目标模拟：通过降低 IR 签名、增加噪声和遮挡模型，模拟隐身目标的捕获概率；多传感器融合提高置信度并触发高优先级告警。

### 2.3 电子战（EW）仿真

* 输入仿真：支持注入 EW 信号影响（测角偏移、虚假目标、SNR 降低、丢帧、时延）；提供可配置的干扰策略（宽带噪声、脉冲干扰、诱饵/诱骗）。
* 抗欺骗测试：通过改变检测阈值与融合策略，验证跟踪稳定性、误报率与丢失率；统计并可视化干扰前后性能指标。

### 2.4 接口与协议（仿真真实系统接口）

* 输出数据格式与真实系统兼容：可配置为 FC 总线、AFDX、或高速以太网（JSON-over-UDP/TCP 或二进制帧）；每条消息包含时间戳、传感器 ID、角位置（az, el）、测距（m）、目标 ID/track、置信度、告警级别等。
* 支持多协议接入综合处理计算机：实现示例适配器（JSON-over-UDP、binary-over-TCP）；提供 send/recv 示例客户端脚本。

### 2.5 导引与武器仿真

* 精确制导仿真：模拟 IRST 激光测距为激光制导炸弹/制导弹药提供制导点（坐标、时间同步），支持多目标交战（MEO）场景下的优先级分配、制导逻辑验证与复合制导（IRST+INS）导航精度仿真。

### 2.6 可视化与交互

* 实时画面：视频/图像窗口展示目标画面（可放大某一路），标注检测框、track ID、距离、速度与置信度；帧率可配置，目标画面最高支持 ≥100Hz（硬件/环境允许）。
* 仪表盘：显示关键参数（当前帧率、网络带宽、测距误差、误报率/漏报率、跟踪数量），可调整阈值、滤波器与干扰强度。
* 操作控制：场景加载/保存、Start/Pause/Stop/Step、手动注入目标或伪目标、导出数据（CSV/JSON）、录制回放。

---

## 三、性能与约束

* 帧率：UI 与后端仿真支持最高 100Hz+（若硬件或 Python 环境限制，则提供退化模式并在 README 说明）。
* 延迟：网络/总线仿真延迟可配置（模拟设备时延）；测距与定位延迟应在输出消息里标注时间戳。
* 资源管理：提供多进程选项用于视频处理与压缩，避免主线程阻塞；支持配置最大并发流数。

---

## 四、数据与消息示例（规范）

### 检测/观测报文（JSON-over-UDP）

```json
{
  "msg_type": "observation",
  "sensor_id": "IRST_FWD_01",
  "timestamp_utc": "2025-11-27T06:00:00.123Z",
  "frame_number": 12345,
  "detections": [
    { "detection_id": "D_1001", "az_deg": 12.34, "el_deg": -1.2, "snr_db": 6.7, "confidence": 0.72 }
  ]
}
```

### 跟踪报文（融合输出）

```json
{
  "msg_type": "track",
  "track_id": "TRK_2001",
  "timestamp_utc": "...",
  "state": { "x_m": 12345.6, "y_m": -2345.2, "z_m": 3000, "vx_mps": -120, "vy_mps": 5 },
  "covariance": [[...]],
  "distance_m": 12345.6, 
  "laser_ranging_m": 12345.0,
  "confidence": 0.91,
  "threat_level": "HIGH"
}
```

### 激光测距帧（二进制 header + payload 或 JSON meta + base64）

* header 包含 sensor_id, frame_number, timestamp, range_m, accuracy_m, status_flag。

---

## 五、UI 设计（PyQt5，主界面元素）

* 顶部工具栏：场景管理（Load/Save）、仿真控制（Start/Pause/Stop/Step）、导出/录制。
* 中央画布：实时热像或合成场景视图（可切换真彩/热像伪彩），显示检测框与跟踪轨迹。
* 右侧：跟踪列表（Track ID、位置、距离、速率、置信度、威胁等级）、干扰控制面板（开关/强度滑条）、激光测距控制（启用/禁用/精度调节）。
* 底部：帧率/带宽/日志/性能监控（实时曲线或数值）。
* 弹窗/对话：手动添加目标、注入 EW、配置接口参数（IP/Port/Protocol）。

---

## 六、实现建议与技术选型

* 并发：使用 asyncio 处理网络 I/O，使用 multiprocessing.Process + Queue 处理高频图像解码/增强与测距计算（避免 GIL）。
* 图像处理：OpenCV (cv2) 进行图像仿真（热图生成、增强、噪声、模糊、对比度调整）；若需要视频压缩/传输可使用 imagecodecs/glymur 或模拟压缩（量化 + 模糊）。
* 跟踪：numpy+scipy 实现卡尔曼滤波器；提供接口以替换为其他跟踪算法（JPDA/MHT）。
* 配置/验证：使用 pydantic 或 dataclasses + YAML 场景文件；提供单元测试（pytest）与示例场景。
* 日志：python logging（文件与 UI 同步输出）。

---

## 七、交付物清单（最小交付）

* 项目目录（README、requirements.txt、run_demo.sh、main.py）。
* 模块：`sim/`（target_gen, irst_sensor, detector, tracker, laser_ranger, fusion, ew）, `ui/`（main_window, video_view, dashboard）, `io/`（udp_server, tcp_control, afdx_adapter_stub）, `tests/`（pytest 示例）。
* 示例场景：空战、隐身目标检测、EW 强场景、制导引导场景。
* 示例客户端：`send_test_observation.py`（向仿真器发送观测/控制报文），以及场景运行脚本。

---

## 八、验收标准（Acceptance Criteria）

1. 可加载场景并在 UI 上实时显示 IR 图像/热图，检测框、track ID 与激光测距信息可视化。
2. 支持角度测量 + 激光测距融合定位，定位精度与测距误差可统计并导出（CSV/JSON）。
3. 支持隐身目标低 SNR 模拟，经过多传感器融合可触发高置信度威胁告警。
4. 可注入 EW 信号／伪目标并观测跟踪性能下降（误报率/漏报率、跟踪丢失率上升）。
5. 提供网络接口（UDP/TCP 示例适配器），并能与示例客户端交互发送/接收报文。
6. 包含至少若干 pytest 单元测试，关键模块通过测试。

